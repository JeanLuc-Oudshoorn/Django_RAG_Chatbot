{% extends 'base.html' %}

{% block content %}
<div class="text-center mb-4">
    <h1 class="display-4 smaller-heading">Q-Assistant AI</h1>
</div>
<div id="chatbot" hx-ext="ws" ws-connect="/ws/ai-demo/{{ conversation.id }}/" class="card">
    <div class="card-body">
        <div class="conversation" id="message-list">
            {% if conversation.conversation %}
                {% for message in conversation.conversation %}
                    <div class="{% if message.role == 'user' %}user-message{% else %}chatbot-message{% endif %} mb-2">
                        {{ message.content }}
                    </div>
                {% endfor %}
            {% else %}
                <div class="chatbot-message2" style="background-color: white !important; align-self: flex-start; border-radius: 15px 15px 15px 0; padding: 10px 15px; margin: 5px 0; max-width: 80%; font-size: 1.1em;">
                    Stuur een vraag over voedselveiligheid om een gesprek te beginnen.
                </div>
            {% endif %}
        </div>
    </div>
    <div class="card-footer">
        <form id="input-form" ws-send class="d-flex">
            <input id="input-field" name="message" type="text" placeholder="Schrijf hier je bericht" class="form-control me-2">
            <button id="submit-button" type="submit" class="btn btn-primary">
                Verstuur
            </button>
        </form>
    </div>
</div>
<script>
  // clear message input after sending our new message
  document.body.addEventListener('htmx:wsAfterSend', function(evt) {
    document.getElementById("input-field").value = "";
  });
  // scroll to bottom of chat after every incoming message
  document.body.addEventListener('htmx:wsAfterMessage', function(evt) {
    const chatUI = document.getElementById('message-list');
    chatUI.scrollTop = chatUI.scrollHeight;
  });
</script>
{% endblock %}